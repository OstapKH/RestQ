# PostgreSQL Configuration Template
# Generated by Ansible for RestQ Framework

#------------------------------------------------------------------------------
# MEMORY CONFIGURATION
#------------------------------------------------------------------------------

# Memory PostgreSQL uses for caching data (shared memory)
# Recommended: 25% of system RAM for dedicated database servers
shared_buffers = {{ postgresql_config.shared_buffers }}

# Memory for internal operations like sorting or hashing per operation
# Each operation can use this much memory
work_mem = {{ postgresql_config.work_mem }}

# Memory for maintenance tasks like VACUUM or CREATE INDEX
# Should be larger than work_mem for maintenance operations
maintenance_work_mem = {{ postgresql_config.maintenance_work_mem }}

# Effective cache size (used by query planner), commented
# Default: 4GB (should be set to ~75% of available RAM)
# effective_cache_size = 4GB

#------------------------------------------------------------------------------
# CONNECTION AND AUTHENTICATION
#------------------------------------------------------------------------------

# Maximum number of concurrent connections
# Should match or exceed Hikari maximum_pool_size
max_connections = {{ postgresql_config.max_connections }}

# Listen address (default: localhost)
listen_addresses = 'localhost'

# Port number (default: 5432)
port = 5432

#------------------------------------------------------------------------------
# RESOURCE USAGE
#------------------------------------------------------------------------------

# Maximum stack depth for each server process
# Default is 2MB, increase if you get stack depth errors
max_stack_depth = {{ postgresql_config.max_stack_depth }}

#------------------------------------------------------------------------------
# WRITE AHEAD LOG
#------------------------------------------------------------------------------

# Checkpoints are the points in the sequence of transactions at which it is guaranteed
# that the heap and index data files have been updated with all information written
# before that checkpoint.
# Default: 0.9
checkpoint_completion_target = 0.9

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

# Sets the planner's estimate of the cost of a non-sequentially-fetched disk page
# Default: 4.0 (higher for traditional spinning disks, lower for SSDs)
random_page_cost = 4.0

# Sets the planner's estimate of the cost of processing each tuple during a query
# Default: 0.01
cpu_tuple_cost = 0.01

# Sets the planner's estimate of the cost of processing each index entry during an index scan
# Default: 0.005
cpu_index_tuple_cost = 0.005

#------------------------------------------------------------------------------
# LOGGING
#------------------------------------------------------------------------------

# Enables logging of each SQL statement
# Default: 'none' (options: 'none', 'ddl', 'mod', 'all')
log_statement = 'none'

# Enables logging of the duration of each completed statement
# Default: off
log_duration = off

# Enables logging of connection attempts and disconnections
# Default: off (recommended: on for debugging)
log_connections = off

# Enables logging of disconnections
# Default: off
log_disconnections = off

#------------------------------------------------------------------------------
# STATISTICS
#------------------------------------------------------------------------------

# Enables collection of statistics on database activity
# Default: on
track_activities = on

# Enables collection of statistics on database I/O activity
# Default: off
track_io_timing = off

# Enables collection of statistics on function calls
# Default: none (options: none, pl, all)
track_functions = none

#------------------------------------------------------------------------------
# AUTOVACUUM
#------------------------------------------------------------------------------

# Starts the autovacuum subprocess
# Default: on
autovacuum = on

# Specifies the minimum number of updated or deleted tuples needed to trigger an autovacuum
# Default: 50
autovacuum_vacuum_threshold = 50

# Specifies a fraction of the table size to add to autovacuum_vacuum_threshold
# Default: 0.2
autovacuum_vacuum_scale_factor = 0.2

#------------------------------------------------------------------------------
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------

# Sets the time zone for displaying and interpreting time stamps
timezone = 'UTC'

# Sets the locale for formatting date/time values
lc_messages = 'C'

# Sets the locale for formatting monetary amounts
lc_monetary = 'C'

# Sets the locale for formatting numbers
lc_numeric = 'C'

# Sets the locale for formatting date/time values
lc_time = 'C'

# Sets the locale for sorting data
default_text_search_config = 'pg_catalog.english'
